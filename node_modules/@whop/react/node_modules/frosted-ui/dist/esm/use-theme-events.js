'use client';
import React, { useEffect } from 'react';
import { useThemeContext } from './theme';
import { themePropDefs } from './theme-options';
function validateThemeColor(key, value) {
    const validValues = themePropDefs[key].values;
    return validValues.includes(value);
}
function validateThemeOptions(detail) {
    if (typeof detail !== 'object' || !detail)
        return {};
    const ret = {};
    const keysToCheck = [
        'accentColor',
        'appearance',
        'dangerColor',
        'grayColor',
        'infoColor',
        'successColor',
        'warningColor',
    ];
    for (const key of keysToCheck) {
        if (!(key in detail))
            continue;
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        if (!validateThemeColor(key, detail[key])) {
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            console.warn(`Invalid value for ${key}: ${detail[key]}`);
            continue;
        }
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        ret[key] = detail[key];
    }
    return ret;
}
export function useThemeEvents() {
    const { accentColor, appearance, dangerColor, grayColor, infoColor, successColor, warningColor, onAccentColorChange, onAppearanceChange, onDangerColorChange, onGrayColorChange, onInfoColorChange, onSuccessColorChange, onWarningColorChange, } = useThemeContext();
    // Emit an event when the component is mounted.
    // Listen for theme changes from the outside.
    useEffect(() => {
        const listener = (e) => {
            if (e instanceof CustomEvent) {
                const d = validateThemeOptions(e.detail);
                if (d.appearance)
                    onAppearanceChange(d.appearance);
                if (d.accentColor)
                    onAccentColorChange(d.accentColor);
                if (d.grayColor)
                    onGrayColorChange(d.grayColor);
                if (d.infoColor)
                    onInfoColorChange(d.infoColor);
                if (d.successColor)
                    onSuccessColorChange(d.successColor);
                if (d.warningColor)
                    onWarningColorChange(d.warningColor);
                if (d.dangerColor)
                    onDangerColorChange(d.dangerColor);
            }
        };
        document.documentElement.addEventListener('frosted-ui:set-theme', listener);
        // Let external code know that the component is mounted.
        const event = new CustomEvent('frosted-ui:mounted');
        document.documentElement.dispatchEvent(event);
        return () => {
            document.documentElement.removeEventListener('frosted-ui:set-theme', listener);
            const event = new CustomEvent('frosted-ui:unmounted');
            document.documentElement.dispatchEvent(event);
        };
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);
    // Emit an event when the theme is changed.
    React.useEffect(() => {
        const event = new CustomEvent('frosted-ui:on-theme-change', {
            detail: {
                appearance,
                accentColor,
                grayColor,
                infoColor,
                successColor,
                warningColor,
                dangerColor,
            },
        });
        document.documentElement.dispatchEvent(event);
    }, [appearance, accentColor, grayColor, infoColor, successColor, warningColor, dangerColor]);
}
export const WithThemeEvents = () => {
    useThemeEvents();
    return null;
};
//# sourceMappingURL=use-theme-events.js.map